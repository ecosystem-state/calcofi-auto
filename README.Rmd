---
output:
  md_document:
    variant: gfm
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
library(knitr)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-figs/",
  cache.path = "README-cache/"
)
```

  <!-- badges: start -->

  [![Pull data](https://github.com/ecosystem-state/calcofi-auto/workflows/R-pull-data/badge.svg)](https://github.com/ecosystem-state/calcofi-auto/actions)
  
  [![Make grid](https://github.com/ecosystem-state/calcofi-auto/workflows/R-gen-grid/badge.svg)](https://github.com/ecosystem-state/calcofi-auto/actions)  
  
[![R-gen-index](https://github.com/ecosystem-state/calcofi-auto/actions/workflows/R-gen-indices.yaml/badge.svg)](https://github.com/ecosystem-state/calcofi-auto/actions/workflows/R-gen-indices.yaml)
  
  [![Run DFA models](https://github.com/ecosystem-state/calcofi-auto/workflows/R-run-dfa/badge.svg)](https://github.com/ecosystem-state/calcofi-auto/actions)
  <!-- badges: end -->
  
## Overview 
This repository is a demonstration of automatic index generation using data from CalCOFI and ERDDAP. The index is generated by applying Dynamic Factor Analysis (DFA) to the top ~ 50 species, using spring samples collected 1985 - present.

If you're looking for data:  
* time series (with uncertainty) are in indices/predicted_indices_sdmtmb.rds  
* the prediction grid is in indices/pred_grid.rds  
* estimated DFA trends are in data/index_data.rds  

## Results

We find that a model with 3 trends has better predictive accuracy than a model with 1-2 trends. 

```{r echo=FALSE, fig.cap="Estimated trends for the CalCOFI community"}
# All defaults
include_graphics("figures/trends.jpeg")
```

```{r echo=FALSE, fig.cap="Estimated loadings for the CalCOFI community"}
# All defaults
include_graphics("figures/loadings.jpeg")
```

```{r echo=FALSE, width = 8, fig.cap="Predicted and observed fits to the CalCOFI data"}
# All defaults
include_graphics("figures/fitted.jpeg")
```

## bayesdfa

For more on the approach used, check out the [bayesdfa R package](https://fate-ewi.github.io/bayesdfa/)
